//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using Ajuna.Infrastructure.Storages;
using Ajuna.NetApi.Model.FrameSupport;
using Ajuna.NetApi.Model.SpCore;
using Ajuna.NetApi.Model.Types.Base;
using Ajuna.NetApi.Model.Types.Primitive;
using Microsoft.AspNetCore.Mvc;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;


namespace Ajuna.Infrastructure.RestService.Controller
{
    
    
    /// <summary>
    /// ImOnlineController controller to access storages.
    /// </summary>
    [ApiController()]
    [Route("[controller]")]
    public sealed class ImOnlineController : ControllerBase
    {
        
        private IImOnlineStorage _imOnlineStorage;
        
        /// <summary>
        /// ImOnlineController constructor.
        /// </summary>
        public ImOnlineController(IImOnlineStorage imOnlineStorage)
        {
            _imOnlineStorage = imOnlineStorage;
        }
        
        /// <summary>
        /// >> HeartbeatAfter
        ///  The block number after which it&#39;s ok to send heartbeats in the current
        ///  session.
        /// 
        ///  At the beginning of each session we set this to a value that should fall
        ///  roughly in the middle of the session duration. The idea is to first wait for
        ///  the validators to produce a block in the current session, so that the
        ///  heartbeat later on will not be necessary.
        /// 
        ///  This value will only be used as a fallback if we fail to get a proper session
        ///  progress estimate from `NextSessionRotation`, as those estimates should be
        ///  more accurate then the value we calculate for `HeartbeatAfter`.
        /// </summary>
        [HttpGet("HeartbeatAfter")]
        [ProducesResponseType(typeof(Ajuna.NetApi.Model.Types.Primitive.U32), 200)]
        public IActionResult GetHeartbeatAfter()
        {
            return this.Ok(_imOnlineStorage.GetHeartbeatAfter());
        }
        
        /// <summary>
        /// >> Keys
        ///  The current set of keys that may issue a heartbeat.
        /// </summary>
        [HttpGet("Keys")]
        [ProducesResponseType(typeof(Ajuna.NetApi.Model.FrameSupport.WeakBoundedVecT4), 200)]
        public IActionResult GetKeys()
        {
            return this.Ok(_imOnlineStorage.GetKeys());
        }
        
        /// <summary>
        /// >> ReceivedHeartbeats
        ///  For each session index, we keep a mapping of &#39;SessionIndex` and `AuthIndex` to
        ///  `WrapperOpaque&lt;BoundedOpaqueNetworkState&gt;`.
        /// </summary>
        [HttpGet("ReceivedHeartbeats")]
        [ProducesResponseType(typeof(Ajuna.NetApi.Model.FrameSupport.WrapperOpaque), 200)]
        public IActionResult GetReceivedHeartbeats(string key)
        {
            return this.Ok(_imOnlineStorage.GetReceivedHeartbeats(key));
        }
        
        /// <summary>
        /// >> AuthoredBlocks
        ///  For each session index, we keep a mapping of `ValidatorId&lt;T&gt;` to the
        ///  number of blocks authored by the given authority.
        /// </summary>
        [HttpGet("AuthoredBlocks")]
        [ProducesResponseType(typeof(Ajuna.NetApi.Model.Types.Primitive.U32), 200)]
        public IActionResult GetAuthoredBlocks(string key)
        {
            return this.Ok(_imOnlineStorage.GetAuthoredBlocks(key));
        }
    }
}
